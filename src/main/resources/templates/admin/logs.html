<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>操作日志</title>
    <link rel="stylesheet" th:href="@{/css/app.css}"/>
</head>
<body>
<div class="container">
    <div class="card">
        <h2>操作日志</h2>
        <div class="nav-links">
            <a class="btn" th:href="@{/admin}">返回首页</a>
        </div>
        
        <!-- 筛选表单 -->
        <form method="get" th:action="@{/admin/logs}" class="filter-form">
            <div class="form-row">
                <div class="form-group">
                    <label>角色筛选：</label>
                    <select name="role">
                        <option value="">全部角色</option>
                        <option value="admin" th:selected="${selectedRole == 'admin'}">管理员</option>
                        <option value="counselor" th:selected="${selectedRole == 'counselor'}">辅导员</option>
                        <option value="group" th:selected="${selectedRole == 'group'}">评议小组</option>
                        <option value="dean" th:selected="${selectedRole == 'dean'}">院长</option>
                        <option value="student" th:selected="${selectedRole == 'student'}">学生</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>操作类型：</label>
                    <select name="operationType">
                        <option value="">全部类型</option>
                        <option value="登录" th:selected="${selectedOperationType == '登录'}">登录</option>
                        <option value="发布公告" th:selected="${selectedOperationType == '发布公告'}">发布公告</option>
                        <option value="发布公示" th:selected="${selectedOperationType == '发布公示'}">发布公示</option>
                        <option value="确认公示" th:selected="${selectedOperationType == '确认公示'}">确认公示</option>
                        <option value="审核申请" th:selected="${selectedOperationType == '审核申请'}">审核申请</option>
                        <option value="提交申请" th:selected="${selectedOperationType == '提交申请'}">提交申请</option>
                        <option value="绑定辅导员" th:selected="${selectedOperationType == '绑定辅导员'}">绑定辅导员</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>开始日期：</label>
                    <input type="date" name="startDate" th:value="${startDate}"/>
                </div>
                <div class="form-group">
                    <label>结束日期：</label>
                    <input type="date" name="endDate" th:value="${endDate}"/>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn">筛选</button>
                    <a class="btn btn-outline" th:href="@{/admin/logs}">重置</a>
                </div>
            </div>
        </form>
        
        <!-- 统计信息 -->
        <div class="stats-section">
            <h3>统计信息</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>按角色统计</h4>
                    <div th:each="stat : ${roleStats}">
                        <span th:text="${stat[0]}"></span>: <span th:text="${stat[1]}"></span>次
                    </div>
                </div>
                <div class="stat-card">
                    <h4>按操作类型统计</h4>
                    <div th:each="stat : ${operationStats}">
                        <span th:text="${stat[0]}"></span>: <span th:text="${stat[1]}"></span>次
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 日志列表 -->
        <h3>操作日志列表</h3>
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>时间</th>
                        <th>用户</th>
                        <th>角色</th>
                        <th>操作类型</th>
                        <th>操作内容</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="log : ${logs}">
                        <td th:text="${#temporals.format(log.operationTime, 'yyyy-MM-dd HH:mm:ss')}"></td>
                        <td th:text="${log.user.name}"></td>
                        <td>
                            <span class="role-badge" th:classappend="'role-' + ${log.role}" th:text="${log.role}"></span>
                        </td>
                        <td th:text="${log.operationType}"></td>
                        <td th:text="${log.operationContent}"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div th:if="${logs.isEmpty()}" class="no-data">
            <p>没有找到符合条件的操作日志。</p>
        </div>
        
        <!-- 导出按钮 -->
        <div class="export-section">
            <a class="btn btn-outline" th:href="@{/admin/logs/export(role=${selectedRole}, operationType=${selectedOperationType}, startDate=${startDate}, endDate=${endDate})}">
                导出Excel
            </a>
        </div>
    </div>
</div>

<style>
    .filter-form {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
    }
    
    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
        align-items: end;
    }
    
    .form-group {
        display: flex;
        flex-direction: column;
        min-width: 150px;
    }
    
    .form-group label {
        margin-bottom: 5px;
        font-weight: 500;
    }
    
    .form-group select,
    .form-group input {
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    
    .stats-section {
        margin: 20px 0;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 15px 0;
    }
    
    .stat-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #dee2e6;
    }
    
    .stat-card h4 {
        margin: 0 0 10px 0;
        color: #1976d2;
    }
    
    .table-container {
        overflow-x: auto;
        margin: 20px 0;
    }
    
    .role-badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
    }
    
    .role-admin { background: #dc3545; color: white; }
    .role-counselor { background: #28a745; color: white; }
    .role-group { background: #ffc107; color: black; }
    .role-dean { background: #17a2b8; color: white; }
    .role-student { background: #6c757d; color: white; }
    
    .no-data {
        text-align: center;
        padding: 40px;
        color: #6c757d;
    }
    
    .export-section {
        margin-top: 20px;
        text-align: right;
    }
</style>
</body>
</html>


